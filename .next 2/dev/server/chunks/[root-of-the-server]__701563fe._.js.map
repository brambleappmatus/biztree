{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 112, "column": 0}, "map": {"version":3,"sources":["file:///Users/matusstano/Desktop/biztree/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\n\nconst prismaClientSingleton = () => {\n    return new PrismaClient();\n};\n\ndeclare global {\n    var prisma: undefined | ReturnType<typeof prismaClientSingleton>;\n}\n\nconst prisma = globalThis.prisma ?? prismaClientSingleton();\n\nexport default prisma;\n\nif (process.env.NODE_ENV !== \"production\") globalThis.prisma = prisma;\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,wBAAwB;IAC1B,OAAO,IAAI,6IAAY;AAC3B;AAMA,MAAM,SAAS,WAAW,MAAM,IAAI;uCAErB;AAEf,wCAA2C,WAAW,MAAM,GAAG"}},
    {"offset": {"line": 128, "column": 0}, "map": {"version":3,"sources":["file:///Users/matusstano/Desktop/biztree/src/lib/auth.ts"],"sourcesContent":["import type { NextAuthOptions } from \"next-auth\";\nimport CredentialsProvider from \"next-auth/providers/credentials\";\nimport { PrismaAdapter } from \"@next-auth/prisma-adapter\";\nimport prisma from \"@/lib/prisma\";\nimport bcrypt from \"bcryptjs\";\n\nimport GoogleProvider from \"next-auth/providers/google\";\nimport AppleProvider from \"next-auth/providers/apple\";\n\nexport const authOptions: NextAuthOptions = {\n    debug: true, // Enable debugging to see why sign-in fails\n    adapter: PrismaAdapter(prisma),\n    providers: [\n        GoogleProvider({\n            clientId: process.env.GOOGLE_CLIENT_ID!,\n            clientSecret: process.env.GOOGLE_CLIENT_SECRET!,\n            allowDangerousEmailAccountLinking: true,\n        }),\n        AppleProvider({\n            clientId: process.env.APPLE_ID!,\n            clientSecret: process.env.APPLE_SECRET!,\n            allowDangerousEmailAccountLinking: true,\n        }),\n        CredentialsProvider({\n            name: \"credentials\",\n            credentials: {\n                email: { label: \"Email\", type: \"email\" },\n                password: { label: \"Password\", type: \"password\" }\n            },\n            async authorize(credentials) {\n                if (!credentials?.email || !credentials?.password) {\n                    return null;\n                }\n\n                const user = await prisma.user.findUnique({\n                    where: { email: credentials.email }\n                });\n\n                if (!user || !user.password) {\n                    return null;\n                }\n\n                const isPasswordValid = await bcrypt.compare(\n                    credentials.password,\n                    user.password\n                );\n\n                if (!isPasswordValid) {\n                    return null;\n                }\n\n                return {\n                    id: user.id,\n                    email: user.email,\n                    role: user.role,\n                    onboardingCompleted: user.onboardingCompleted\n                };\n            }\n        })\n    ],\n    session: {\n        strategy: \"jwt\"\n    },\n    pages: {\n        signIn: \"/login\",\n    },\n    callbacks: {\n        async signIn({ user, account, profile }) {\n            if (account?.provider === \"google\" || account?.provider === \"apple\") {\n                console.log(`üîê ${account.provider} Sign In Attempt:`, {\n                    userEmail: user.email,\n                    accountProvider: account.provider,\n                    profileEmail: profile?.email\n                });\n\n                // Check if user exists with this email\n                const existingUser = await prisma.user.findUnique({\n                    where: { email: user.email! },\n                    include: { accounts: true }\n                });\n\n                if (existingUser) {\n                    // Check if this OAuth provider is already linked\n                    const isLinked = existingUser.accounts.some(\n                        acc => acc.provider === account.provider\n                    );\n\n                    if (!isLinked) {\n                        // Link the account\n                        console.log(\"üîó Linking OAuth account to existing user\");\n                        await prisma.account.create({\n                            data: {\n                                userId: existingUser.id,\n                                type: account.type,\n                                provider: account.provider,\n                                providerAccountId: account.providerAccountId,\n                                refresh_token: account.refresh_token,\n                                access_token: account.access_token,\n                                expires_at: account.expires_at,\n                                token_type: account.token_type,\n                                scope: account.scope,\n                                id_token: account.id_token,\n                                session_state: account.session_state,\n                            }\n                        });\n                    }\n                }\n            }\n            return true;\n        },\n        async jwt({ token, user }) {\n            if (user) {\n                token.role = (user as any).role;\n                token.onboardingCompleted = (user as any).onboardingCompleted;\n            }\n            return token;\n        },\n        async session({ session, token }) {\n            if (session.user) {\n                (session.user as any).id = token.sub!;\n                (session.user as any).role = token.role as string;\n                (session.user as any).onboardingCompleted = token.onboardingCompleted as boolean;\n            }\n            return session;\n        }\n    },\n    events: {\n        async createUser({ user }) {\n            console.log(\"üë§ User Created:\", user);\n\n            // Send welcome email for new users (including OAuth users)\n            try {\n                const { Resend } = await import(\"resend\");\n                const { WelcomeEmail } = await import(\"@/components/emails/WelcomeEmail\");\n\n                const resend = new Resend(process.env.RESEND_API_KEY);\n\n                await resend.emails.send({\n                    from: 'BizTree <no-reply@biztree.bio>',\n                    to: user.email!,\n                    subject: 'Vitajte v BizTree!',\n                    react: WelcomeEmail({\n                        name: user.name || user.email!.split('@')[0]\n                    }) as React.ReactNode,\n                });\n\n                console.log(\"‚úÖ Welcome email sent to:\", user.email);\n            } catch (emailError) {\n                console.error(\"‚ùå Failed to send welcome email:\", emailError);\n                // Don't fail user creation if email fails\n            }\n        },\n        async linkAccount({ user, account }) {\n            console.log(\"üîó Account Linked:\", { userId: user.id, provider: account.provider });\n        },\n        async signIn({ user, account, isNewUser }) {\n            console.log(\"‚úÖ Sign In Successful:\", { userId: user.id, isNewUser, provider: account?.provider });\n        }\n    },\n    secret: process.env.NEXTAUTH_SECRET,\n};\n\nexport async function hashPassword(password: string): Promise<string> {\n    return bcrypt.hash(password, 12);\n}\n\nexport async function verifyPassword(password: string, hashedPassword: string): Promise<boolean> {\n    return bcrypt.compare(password, hashedPassword);\n}\n\nexport function isSuperAdmin(session: any): boolean {\n    return session?.user?.role === \"SUPERADMIN\";\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 317, "column": 0}, "map": {"version":3,"sources":["file:///Users/matusstano/Desktop/biztree/src/app/api/gallery/albums/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport { getServerSession } from \"next-auth\";\nimport { authOptions } from \"@/lib/auth\";\nimport prisma from \"@/lib/prisma\";\n\nexport async function GET(request: NextRequest) {\n    try {\n        const session = await getServerSession(authOptions);\n        if (!session?.user?.id) {\n            return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n        }\n\n        // Get profile ID from query param or infer from user\n        const { searchParams } = new URL(request.url);\n        const profileId = searchParams.get(\"profileId\");\n\n        if (!profileId) {\n            return NextResponse.json({ error: \"Profile ID required\" }, { status: 400 });\n        }\n\n        // Verify ownership\n        const profile = await prisma.profile.findUnique({\n            where: { id: profileId },\n            select: { userId: true }\n        });\n\n        if (!profile || profile.userId !== session.user.id) {\n            return NextResponse.json({ error: \"Unauthorized\" }, { status: 403 });\n        }\n\n        const albums = await prisma.galleryAlbum.findMany({\n            where: { profileId },\n            include: {\n                images: {\n                    orderBy: { order: 'asc' }\n                }\n            },\n            orderBy: { order: 'asc' }\n        });\n\n        return NextResponse.json(albums);\n    } catch (error) {\n        console.error(\"Error fetching albums:\", error);\n        return NextResponse.json({ error: \"Internal server error\" }, { status: 500 });\n    }\n}\n\nexport async function POST(request: NextRequest) {\n    try {\n        const session = await getServerSession(authOptions);\n        if (!session?.user?.id) {\n            return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n        }\n\n        const body = await request.json();\n        const { name, profileId } = body;\n\n        if (!name || !profileId) {\n            return NextResponse.json({ error: \"Name and Profile ID required\" }, { status: 400 });\n        }\n\n        // Verify ownership\n        const profile = await prisma.profile.findUnique({\n            where: { id: profileId },\n            select: { userId: true }\n        });\n\n        if (!profile || profile.userId !== session.user.id) {\n            return NextResponse.json({ error: \"Unauthorized\" }, { status: 403 });\n        }\n\n        // Get max order\n        const lastAlbum = await prisma.galleryAlbum.findFirst({\n            where: { profileId },\n            orderBy: { order: 'desc' }\n        });\n        const newOrder = (lastAlbum?.order ?? -1) + 1;\n\n        const album = await prisma.galleryAlbum.create({\n            data: {\n                name,\n                profileId,\n                order: newOrder\n            }\n        });\n\n        return NextResponse.json(album);\n    } catch (error) {\n        console.error(\"Error creating album:\", error);\n        return NextResponse.json({ error: \"Internal server error\" }, { status: 500 });\n    }\n}\n"],"names":[],"mappings":"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"}}]
}