{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/matusstano/Desktop/biztree/src/proxy.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport type { NextRequest } from \"next/server\";\n\nexport function proxy(req: NextRequest) {\n    const url = req.nextUrl;\n    const hostname = req.headers.get(\"host\") || \"\";\n\n    // Skip subdomain routing for Vercel deployment URLs\n    if (hostname.includes(\"vercel.app\")) {\n        return NextResponse.next();\n    }\n\n    // Define allowed domains (localhost, biztree.sk, biztree.bio, etc.)\n    const allowedDomains = [\"localhost\", \"biztree.sk\", \"biztree.bio\"];\n\n    // Remove port from hostname for domain check\n    const hostnameWithoutPort = hostname.split(\":\")[0];\n\n    // Check if the current hostname is a subdomain\n    const isSubdomain = !allowedDomains.some(domain => hostnameWithoutPort === domain || hostnameWithoutPort.endsWith(`.${domain}`));\n\n    // Extract subdomain\n    // For localhost:3000, subdomains are like test.localhost:3000\n    // For biztree.sk, subdomains are like test.biztree.sk\n    let subdomain = \"\";\n\n    if (hostname.includes(\"localhost\")) {\n        const parts = hostname.split(\".\");\n        if (parts.length > 1 && parts[0] !== \"localhost\") {\n            subdomain = parts[0];\n        }\n    } else {\n        const parts = hostname.split(\".\");\n        if (parts.length > 2) {\n            subdomain = parts[0];\n        }\n    }\n\n    // Handle subdomain routing\n    if (subdomain && subdomain !== \"www\" && !url.pathname.startsWith(\"/privacy\") && !url.pathname.startsWith(\"/cookies\") && !url.pathname.startsWith(\"/textures\")) {\n        // Rewrite to /app/[subdomain]\n        console.log(`Rewriting subdomain ${subdomain} to /app/${subdomain}${url.pathname}`);\n        return NextResponse.rewrite(new URL(`/app/${subdomain}${url.pathname}`, req.url));\n    }\n\n    // Handle admin routing with onboarding check\n    if (url.pathname.startsWith(\"/admin\")) {\n        // Get the session token from cookies\n        const sessionToken = req.cookies.get(\"next-auth.session-token\") || req.cookies.get(\"__Secure-next-auth.session-token\");\n\n        // If no session, redirect to login\n        if (!sessionToken) {\n            return NextResponse.redirect(new URL(\"/login\", req.url));\n        }\n\n        // Note: We can't easily check onboardingCompleted in middleware without a database call\n        // The server component will handle the onboarding redirect\n        // But we can add a loading state to prevent the flash\n        return NextResponse.next();\n    }\n\n    // Handle public landing page (no subdomain)\n    if (!subdomain || subdomain === \"www\") {\n        // If accessing root path, serve the landing page\n        // which is effectively the default handling in App Router (src/app/page.tsx)\n        return NextResponse.next();\n    }\n\n    return NextResponse.next();\n}\n\nexport const config = {\n    matcher: [\n        /*\n         * Match all request paths except for the ones starting with:\n         * - api (API routes)\n         * - _next/static (static files)\n         * - _next/image (image optimization files)\n         * - favicon.ico (favicon file)\n         */\n        \"/((?!api|_next/static|_next/image|favicon.ico).*)\",\n    ],\n};\n"],"names":[],"mappings":";;;;;;AAAA;;AAGO,SAAS,MAAM,GAAgB;IAClC,MAAM,MAAM,IAAI,OAAO;IACvB,MAAM,WAAW,IAAI,OAAO,CAAC,GAAG,CAAC,WAAW;IAE5C,oDAAoD;IACpD,IAAI,SAAS,QAAQ,CAAC,eAAe;QACjC,OAAO,oKAAY,CAAC,IAAI;IAC5B;IAEA,oEAAoE;IACpE,MAAM,iBAAiB;QAAC;QAAa;QAAc;KAAc;IAEjE,6CAA6C;IAC7C,MAAM,sBAAsB,SAAS,KAAK,CAAC,IAAI,CAAC,EAAE;IAElD,+CAA+C;IAC/C,MAAM,cAAc,CAAC,eAAe,IAAI,CAAC,CAAA,SAAU,wBAAwB,UAAU,oBAAoB,QAAQ,CAAC,CAAC,CAAC,EAAE,QAAQ;IAE9H,oBAAoB;IACpB,8DAA8D;IAC9D,sDAAsD;IACtD,IAAI,YAAY;IAEhB,IAAI,SAAS,QAAQ,CAAC,cAAc;QAChC,MAAM,QAAQ,SAAS,KAAK,CAAC;QAC7B,IAAI,MAAM,MAAM,GAAG,KAAK,KAAK,CAAC,EAAE,KAAK,aAAa;YAC9C,YAAY,KAAK,CAAC,EAAE;QACxB;IACJ,OAAO;QACH,MAAM,QAAQ,SAAS,KAAK,CAAC;QAC7B,IAAI,MAAM,MAAM,GAAG,GAAG;YAClB,YAAY,KAAK,CAAC,EAAE;QACxB;IACJ;IAEA,2BAA2B;IAC3B,IAAI,aAAa,cAAc,SAAS,CAAC,IAAI,QAAQ,CAAC,UAAU,CAAC,eAAe,CAAC,IAAI,QAAQ,CAAC,UAAU,CAAC,eAAe,CAAC,IAAI,QAAQ,CAAC,UAAU,CAAC,cAAc;QAC3J,8BAA8B;QAC9B,QAAQ,GAAG,CAAC,CAAC,oBAAoB,EAAE,UAAU,SAAS,EAAE,YAAY,IAAI,QAAQ,EAAE;QAClF,OAAO,oKAAY,CAAC,OAAO,CAAC,IAAI,IAAI,CAAC,KAAK,EAAE,YAAY,IAAI,QAAQ,EAAE,EAAE,IAAI,GAAG;IACnF;IAEA,6CAA6C;IAC7C,IAAI,IAAI,QAAQ,CAAC,UAAU,CAAC,WAAW;QACnC,qCAAqC;QACrC,MAAM,eAAe,IAAI,OAAO,CAAC,GAAG,CAAC,8BAA8B,IAAI,OAAO,CAAC,GAAG,CAAC;QAEnF,mCAAmC;QACnC,IAAI,CAAC,cAAc;YACf,OAAO,oKAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,IAAI,GAAG;QAC1D;QAEA,wFAAwF;QACxF,2DAA2D;QAC3D,sDAAsD;QACtD,OAAO,oKAAY,CAAC,IAAI;IAC5B;IAEA,4CAA4C;IAC5C,IAAI,CAAC,aAAa,cAAc,OAAO;QACnC,iDAAiD;QACjD,6EAA6E;QAC7E,OAAO,oKAAY,CAAC,IAAI;IAC5B;IAEA,OAAO,oKAAY,CAAC,IAAI;AAC5B;AAEO,MAAM,SAAS;IAClB,SAAS;QACL;;;;;;SAMC,GACD;KACH;AACL"}}]
}