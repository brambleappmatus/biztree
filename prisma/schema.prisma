generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                 String    @id @default(cuid())
  name               String?
  email              String    @unique
  emailVerified      DateTime?
  image              String?
  password           String?
  role               String    @default("USER") // USER, ADMIN, SUPER_ADMIN
  onboardingCompleted Boolean  @default(false)
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt
  
  profiles           Profile[]
  accounts           Account[]
  sessions           Session[]
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model Profile {
  id            String   @id @default(cuid())
  subdomain     String   @unique
  name          String
  about         String?
  logo          String?
  phone         String?
  whatsapp      String?
  email         String?
  address       String?
  mapEmbed      String?
  locationLat   Float?
  locationLng   Float?
  
  theme         String   @default("blue") // blue, emerald, coral, etc.
  language      String   @default("sk") // sk, cz, en, pl, hu
  avatarUrl     String?  // URL to profile picture
  bgImage       String?
  bgBlur        Boolean  @default(false)
  bgNoise       Boolean  @default(false)
  
  showBusinessCard Boolean @default(true) // Toggle to show/hide business card on profile
  
  seoTitle      String?
  seoDesc       String?
  
  userId        String?
  user          User?     @relation(fields: [userId], references: [id], onDelete: SetNull)
  
  @@index([userId])
  
  services      Service[]
  socialLinks   SocialLink[]
  links         Link[]
  hours         WorkingHours[]
  bookings      Booking[]
  albums        GalleryAlbum[]
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Service {
  id             String   @id @default(cuid())
  name           String
  description    String?
  price          Decimal?
  duration       Int      // in minutes
  currency       String   @default("EUR")
  bookingEnabled Boolean  @default(true) // Toggle to enable/disable bookings
  
  profileId      String
  profile        Profile  @relation(fields: [profileId], references: [id])
  bookings       Booking[]
  
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model SocialLink {
  id        String   @id @default(cuid())
  platform  String   // facebook, instagram, etc.
  url       String
  
  profileId String
  profile   Profile  @relation(fields: [profileId], references: [id])
}

model Link {
  id        String   @id @default(cuid())
  title     String
  url       String
  order     Int      @default(0)
  
  profileId String
  profile   Profile  @relation(fields: [profileId], references: [id])
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model WorkingHours {
  id        String   @id @default(cuid())
  dayOfWeek Int      // 0 = Sunday, 1 = Monday...
  openTime  String   // "09:00"
  closeTime String   // "17:00"
  isClosed  Boolean  @default(false)
  
  profileId String
  profile   Profile  @relation(fields: [profileId], references: [id])
}

model Booking {
  id          String   @id @default(cuid())
  customerName String
  customerEmail String
  customerPhone String?
  startTime   DateTime
  endTime     DateTime
  status      String   @default("PENDING") // PENDING, CONFIRMED, COMPLETED, CANCELLED
  
  serviceId   String
  service     Service  @relation(fields: [serviceId], references: [id])
  
  profileId   String
  profile     Profile  @relation(fields: [profileId], references: [id])
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Showcase {
  id          String   @id @default(cuid())
  name        String   // Display name for the showcase
  imageUrl    String   // URL to the phone screenshot
  profileUrl  String   // Link to the demo profile
  order       Int      @default(0) // For ordering showcases
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([order])
}


model GalleryAlbum {
  id          String   @id @default(cuid())
  name        String
  description String?
  coverUrl    String?
  order       Int      @default(0)
  isActive    Boolean  @default(true)
  
  profileId   String
  profile     Profile  @relation(fields: [profileId], references: [id], onDelete: Cascade)
  
  images      GalleryImage[]
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([profileId])
  @@index([order])
}

model GalleryImage {
  id          String   @id @default(cuid())
  url         String
  caption     String?
  order       Int      @default(0)
  
  albumId     String
  album       GalleryAlbum @relation(fields: [albumId], references: [id], onDelete: Cascade)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([albumId])
  @@index([order])
}
